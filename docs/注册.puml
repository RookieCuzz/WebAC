@startuml
title 用户注册（短信验证码）
'https://plantuml.com/sequence-diagram

autonumber

actor 用户 as User
participant 前端 as FE
participant "Sms服务" as Message
participant "注册服务" as Auth
participant "Redis" as Queue
database "数据库" as Db
User -> FE: 输入手机号获取验证码
FE -> Message: 给用户发送短信验证码
activate Message
Message --> User: 短信验证码
Message -> Queue: 存储验证码（TTL=30分钟）
note right of Queue: 验证码 30 分钟过期
deactivate Message

User -> FE: 输入手机号+密码+验证码
FE -> Auth: 提交注册
activate Auth
Auth -> Queue: 校验验证码（get + compare）

alt 验证码有效
  Auth -> Db : 对用户账号信息进行脱敏并存入DB
  Auth --> User: 提示注册成功
else 验证码无效
  Auth --> User: 提示注册失败
end
deactivate Auth
@enduml
